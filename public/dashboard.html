<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - YourBrand</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @font-face {
            font-family: agile;
            src: url('/agile.ttf');
        }
        @font-face {
            font-family: modern;
            src: url('/ModernAesthetic-Regular.otf');
        }
        .logop{
        font-family: agile;
        }
        #usernameDisplay{
font-family: modern;
text-transform: capitalize;
background: #121FCF;
background: linear-gradient(to right, #121FCF 6%, #E50000 81%);
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
        }
        .flash-card {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1.5rem;
            border-radius: 1rem;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateX(120%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
            max-width: 400px;
            opacity: 0;
            visibility: hidden;
        }
        .flash-card.show {
            transform: translateX(0);
            opacity: 1;
            visibility: visible;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .weather-card, .music-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .weather-card img {
            width: 100px;
            height: 100px;
        }
        #error-message {
            color: red;
            margin: 10px 0;
        }
        .instagram-card {
            background: linear-gradient(135deg, #833AB4 0%, #FD1D1D 50%, #F77737 100%);
            color: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(131, 58, 180, 0.3);
        }
        .instagram-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 12px 16px;
            color: white;
            backdrop-filter: blur(10px);
        }
        .instagram-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        .instagram-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 12px 24px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        .instagram-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        .instagram-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .tab-button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        .tab-button.active {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* Masonry (Pinterest) layout */
        .masonry-grid {
            columns: 4;
            column-gap: 20px;
        }
        @media (max-width: 1024px) {
            .masonry-grid {
                columns: 2;
            }
        }
        @media (max-width: 600px) {
            .masonry-grid {
                columns: 1;
            }
        }
        .masonry-grid > * {
            break-inside: avoid;
            margin-bottom: 20px;
        }
        #loogoo{
            font-family: agile;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <a href="/" id="loogoo" class="logop text-2xl font-bold text-blue-600">NK</a>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button id="logoutBtn" class="text-gray-600 hover:text-blue-600 transition-colors">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-grow">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-4 text-center">
                    Welcome, <span id="usernameDisplay"></span> to Your Dashboard!
                </h1>
                <p class="text-xl text-gray-600 mb-8 text-center">Time to get this bread bestie! üçû</p>
                
                <!-- Tab Navigation -->
                <div class="flex justify-center mb-8">
                    <button class="tab-button active text-black hover:text-blue-600" data-tab="fashion">Fashion Gallery</button>
                    <button class="tab-button text-black hover:text-blue-600" data-tab="media-library">Media Library</button>
                </div>

                <!-- Fashion Gallery Tab -->
                <div id="fashion-tab" class="tab-content active">
                    <div class="dashboard-container">
                        <div id="error-message"></div>
                        <div id="image-display" class="masonry-grid"></div>
                    </div>
                </div>

                <!-- Media Library Tab -->
                <div id="media-library-tab" class="tab-content">
                    <div class="dashboard-container">
                        <!-- Media Library Header -->
                        <div class="text-center mb-8">
                            <h2 class="text-3xl font-bold text-gray-900 mb-2">Media Library</h2>
                            <p class="text-xl text-gray-600">Browse all media files from webdesigns and tobejson directories</p>
                        </div>

                        <!-- Media Stats -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                                <div class="text-3xl font-bold text-blue-600 mb-2" id="totalMediaCount">-</div>
                                <div class="text-gray-600">Total Media Files</div>
                            </div>
                            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                                <div class="text-3xl font-bold text-green-600 mb-2" id="webdesignsCount">-</div>
                                <div class="text-gray-600">Webdesigns Files</div>
                            </div>
                            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                                <div class="text-3xl font-bold text-purple-600 mb-2" id="tobejsonCount">-</div>
                                <div class="text-gray-600">TobeJSON Files</div>
                            </div>
                        </div>

                        <!-- Filter Controls -->
                        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                            <div class="flex flex-wrap gap-4 items-center justify-center">
                                <button id="filterAll" class="filter-btn active px-4 py-2 rounded-lg bg-blue-500 text-white">
                                    All Media
                                </button>
                                <button id="filterWebdesigns" class="filter-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300">
                                    Webdesigns Only
                                </button>
                                <button id="filterTobejson" class="filter-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300">
                                    TobeJSON Only
                                </button>
                                <button id="filterVideos" class="filter-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300">
                                    Videos Only
                                </button>
                                <button id="filterImages" class="filter-btn px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300">
                                    Images Only
                                </button>
                            </div>
                        </div>

                        <!-- Media Display -->
                        <div id="mediaLibraryDisplay" class="masonry-grid"></div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Flash Card for Notifications -->
        <div id="flashCard" class="flash-card">
            <div class="flex items-center">
                <div class="flex-shrink-0">üß†üí•</div>
                <div class="ml-3">
                    <p class="text-sm font-medium">
                        Thanks for supporting us, you absolute legend! Your vibe is immaculate fr fr üöÄüíÖ<br>Stay slaying, bestie!
                    </p>
                </div>
            </div>
        </div>

        <!-- Welcome Div for Login -->
        <div id="welcomeDiv" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center shadow-2xl transform scale-95 transition-transform duration-300 relative">
                <!-- Close button (X) in top-right corner -->
                <button id="closeWelcomeX" onclick="document.getElementById('welcomeDiv').style.display='none'; console.log('X button clicked inline');" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors">
                    √ó
                </button>
                <div class="text-6xl mb-4">üß†üí•</div>
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Welcome to the Vibe! ‚ú®</h2>
                <p class="text-lg text-gray-700 mb-6 leading-relaxed">
                    Thank you for joining us in this <span class="font-bold text-purple-600">braintrot</span> journey! 
                    Your support means everything fr fr üöÄ
                </p>
                <p class="text-base text-gray-600 mb-6">
                    Time to get this <span class="font-bold text-pink-500">skibidi rizz</span> and slay the day! 
                    No cap, you're absolutely bussin' üíÖ
                </p>
                <button id="closeWelcomeBtn" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all duration-300 transform hover:scale-105">
                    Let's Get This Bread! üçû
                </button>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-white border-t">
            <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
                <p class="text-center text-gray-500 text-sm">
                    ¬© 2024 YourBrand. All rights reserved.
                </p>
            </div>
        </footer>
    </div>

    <script>
        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Check for welcome flag immediately
            console.log('DOM loaded, checking for showWelcomeFlash flag...');
            const showWelcomeFlag = localStorage.getItem('showWelcomeFlash');
            console.log('showWelcomeFlash value:', showWelcomeFlag);
            
            if (showWelcomeFlag) {
                console.log('showWelcomeFlash flag found, showing welcome div');
                // Small delay to ensure DOM is ready
                setTimeout(() => {
                    showWelcomeDiv();
                }, 200);
                localStorage.removeItem('showWelcomeFlash');
                console.log('Flag removed from localStorage');
            } else {
                console.log('No showWelcomeFlash flag found');
            }

            // Function to decode JWT token (simplified for demonstration, not for production with sensitive data)
            function parseJwt (token) {
                try {
                    const base64Url = token.split('.')[1];
                    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                    const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                    }).join(''));
                    return JSON.parse(jsonPayload);
                } catch (e) {
                    console.error("Error decoding JWT: ", e);
                    return null;
                }
            }

            // Username display logic
            const token = localStorage.getItem('token');
            console.log('Token found:', !!token);
            
            // TEMP: Disable login redirect for testing
            // if (!token) {
            //     console.log('No token found, redirecting to login');
            //     window.location.href = '/login';
            //     return;
            // }

            const decodedToken = parseJwt(token);
            console.log('Decoded token:', decodedToken);
            
            const usernameDisplay = document.getElementById('usernameDisplay');
            console.log('Username display element:', usernameDisplay);
            
            if (decodedToken && decodedToken.username) {
                usernameDisplay.textContent = decodedToken.username;
                console.log('Username set from token:', decodedToken.username);
            } else {
                console.warn("Username not found in token or token is invalid.");
                // Fallback: try to get username from localStorage
                const storedUsername = localStorage.getItem('username');
                console.log('Stored username from localStorage:', storedUsername);
                if (storedUsername) {
                    usernameDisplay.textContent = storedUsername;
                    console.log('Username set from localStorage:', storedUsername);
                } else {
                    console.error('No username found in token or localStorage');
                    usernameDisplay.textContent = 'User';
                }
            }

            // Set up logout functionality
            const logoutBtn = document.getElementById('logoutBtn');
            
            console.log('Logout button found:', !!logoutBtn);
            
            if (logoutBtn) {
                logoutBtn.addEventListener('click', async () => {
                    console.log('Logout button clicked');
                    await performLogout();
                });
                console.log('Logout button event listener added');
            } else {
                console.error('Logout button not found!');
            }

            // Tab functionality
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all tabs and buttons
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // Add active class to clicked button and corresponding content
                    button.classList.add('active');
                    const tabId = button.getAttribute('data-tab') + '-tab';
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // Instagram scraping functionality
            const scrapeBtn = document.getElementById('scrapeBtn');
            if (scrapeBtn) {
                scrapeBtn.addEventListener('click', async () => {
                    const username = document.getElementById('instagramUsername').value.trim();
                    const postCount = parseInt(document.getElementById('postCount').value) || 50;
                    const scrapeBtn = document.getElementById('scrapeBtn');
                    const statusDiv = document.getElementById('scrapeStatus');
                    const statusMessage = document.getElementById('statusMessage');
                    const progressBar = document.getElementById('progressBar');
                    const progressFill = document.getElementById('progressFill');

                    if (!username) {
                        showStatus('Please enter an Instagram username', 'error');
                        return;
                    }

                    // Update button state
                    scrapeBtn.disabled = true;
                    scrapeBtn.innerHTML = '<span class="loading-spinner mr-2"></span>Scraping...';
                    statusDiv.classList.remove('hidden');
                    progressBar.classList.remove('hidden');

                    try {
                        showStatus('Starting Instagram scrape...', 'info');
                        updateProgress(10);

                        // Call the actual API endpoint
                        const response = await fetch('https://instapinz-backend.onrender.com/api/scrape-instagram', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                username: username,
                                postCount: postCount
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();

                        if (result.success) {
                            showStatus(result.message, 'success');
                            updateProgress(100);

                            // Add to recent scrapes
                            addToRecentScrapes(username, postCount);

                            // Display scraped posts
                            displayInstagramPosts(result.data);

                        } else {
                            throw new Error(result.error || 'Scraping failed');
                        }

                    } catch (error) {
                        console.error('Scraping error:', error);
                        showStatus(`Scraping failed: ${error.message}`, 'error');
                    } finally {
                        // Reset button state
                        setTimeout(() => {
                            scrapeBtn.disabled = false;
                            scrapeBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Scrape Instagram Posts';
                            statusDiv.classList.add('hidden');
                            progressBar.classList.add('hidden');
                        }, 2000);
                    }
                });
            }

            function showStatus(message, type) {
                const statusMessage = document.getElementById('statusMessage');
                statusMessage.textContent = message;
                statusMessage.className = 'text-sm';
                
                switch(type) {
                    case 'success':
                        statusMessage.classList.add('text-green-200');
                        break;
                    case 'error':
                        statusMessage.classList.add('text-red-200');
                        break;
                    case 'info':
                        statusMessage.classList.add('text-blue-200');
                        break;
                }
            }

            function updateProgress(percentage) {
                const progressFill = document.getElementById('progressFill');
                progressFill.style.width = percentage + '%';
            }

            function addToRecentScrapes(username, postCount) {
                const recentScrapes = document.getElementById('recentScrapes');
                const timestamp = new Date().toLocaleString();
                
                const scrapeItem = document.createElement('div');
                scrapeItem.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                scrapeItem.innerHTML = `
                    <div>
                        <span class="font-medium">@${username}</span>
                        <span class="text-gray-500 ml-2">${postCount} posts</span>
                    </div>
                    <div class="text-sm text-gray-400">${timestamp}</div>
                `;
                
                // Remove the "no scrapes" message if it exists
                const noScrapesMsg = recentScrapes.querySelector('p');
                if (noScrapesMsg && noScrapesMsg.textContent.includes('No recent scrapes')) {
                    noScrapesMsg.remove();
                }
                
                recentScrapes.insertBefore(scrapeItem, recentScrapes.firstChild);
            }

            function displayInstagramPosts(scrapedData) {
                const instagramPosts = document.getElementById('instagramPosts');
                const instagramGallery = document.getElementById('instagramGallery');
                
                // Clear previous posts
                instagramGallery.innerHTML = '';
                
                if (!scrapedData || !scrapedData.posts || scrapedData.posts.length === 0) {
                    instagramGallery.innerHTML = '<p class="text-gray-500 text-center col-span-full">No posts found for this account.</p>';
                    instagramPosts.classList.remove('hidden');
                    return;
                }
                
                scrapedData.posts.forEach(post => {
                    const postElement = createPostElement(post);
                    instagramGallery.appendChild(postElement);
                });
                
                instagramPosts.classList.remove('hidden');
            }

            function createPostElement(post) {
                const postDiv = document.createElement('div');
                postDiv.className = 'gallery-item';
                
                // Use the actual media URL from scraped data
                const mediaUrl = post.media_url || post.thumbnail_url || 'https://via.placeholder.com/400x400?text=No+Image';
                
                postDiv.innerHTML = `
                    <div class="relative">
                        ${post.is_video ? 
                            `<video src="${mediaUrl}" class="w-full h-48 object-cover" muted loop></video>
                             <div class="absolute top-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs">
                                 <i class="fas fa-play mr-1"></i>VIDEO
                             </div>` :
                            `<img src="${mediaUrl}" alt="Instagram post" class="w-full h-48 object-cover">`
                        }
                    </div>
                    <div class="p-4">
                        <p class="text-sm text-gray-600 line-clamp-2">${post.caption || 'No caption'}</p>
                        <div class="flex items-center justify-between mt-3 text-xs text-gray-500">
                            <span><i class="fas fa-heart text-red-500 mr-1"></i>${post.likes || 0}</span>
                            <span><i class="fas fa-comment mr-1"></i>${post.comments || 0}</span>
                        </div>
                        <div class="mt-2 text-xs text-gray-400">
                            <i class="fas fa-calendar mr-1"></i>${new Date(post.date).toLocaleDateString()}
                        </div>
                    </div>
                `;
                
                return postDiv;
            }

            // Function to open image modal (reused from original code)
            function openImageModal(mediaUrl) {
                // Create overlay
                const overlay = document.createElement('div');
                overlay.classList.add('fixed', 'inset-0', 'bg-black', 'bg-opacity-75', 'flex', 'items-center', 'justify-center', 'z-50');
                overlay.id = 'image-modal-overlay';

                // Create modal content
                const modalContent = document.createElement('div');
                modalContent.classList.add('relative', 'bg-white', 'p-4', 'rounded-lg', 'max-w-4xl', 'max-h-full', 'overflow-auto');

                // Create media element
                const fullMediaElement = document.createElement('img');
                fullMediaElement.src = mediaUrl;
                fullMediaElement.alt = 'Full Image';
                fullMediaElement.classList.add('max-w-full', 'max-h-[80vh]', 'object-contain');

                // Create close button
                const closeBtn = document.createElement('button');
                closeBtn.innerHTML = '&times;';
                closeBtn.classList.add('absolute', 'top-2', 'right-2', 'text-gray-700', 'hover:text-gray-900', 'text-4xl', 'font-bold', 'p-2');
                closeBtn.addEventListener('click', closeImageModal);

                modalContent.appendChild(fullMediaElement);
                modalContent.appendChild(closeBtn);
                overlay.appendChild(modalContent);
                document.body.appendChild(overlay);

                // Close modal when clicking outside
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        closeImageModal();
                    }
                });
            }

            // Function to close the image modal
            function closeImageModal() {
                const overlay = document.getElementById('image-modal-overlay');
                if (overlay) {
                    overlay.remove();
                }
            }

            // Media Library functionality
            let allMediaData = [];
            let currentFilter = 'all';

            // Load media library on page load
            loadMediaLibrary();

            // Load media library when tab is opened
            const mediaTabBtn = document.querySelector('[data-tab="media-library"]');
            if (mediaTabBtn) {
                mediaTabBtn.addEventListener('click', async () => {
                    await loadMediaLibrary();
                });
            }

            async function loadMediaLibrary() {
                const mediaLibraryDisplay = document.getElementById('mediaLibraryDisplay');
                
                try {
                    const response = await fetch('https://instapinz-backend.onrender.com/api/media-files');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    allMediaData = result.data.all || [];
                    
                    // Update statistics
                    document.getElementById('totalMediaCount').textContent = result.data.total || 0;
                    document.getElementById('webdesignsCount').textContent = result.data.webdesigns?.length || 0;
                    document.getElementById('tobejsonCount').textContent = result.data.tobejson?.length || 0;
                    
                    // Display all media
                    displayMediaLibrary(allMediaData);
                    
                } catch (error) {
                    console.error('Error loading media library:', error);
                    mediaLibraryDisplay.innerHTML = '<p class="text-red-500 text-center col-span-full">Failed to load media library</p>';
                }
            }

            function displayMediaLibrary(mediaItems) {
                const mediaLibraryDisplay = document.getElementById('mediaLibraryDisplay');
                mediaLibraryDisplay.innerHTML = '';
                if (!mediaItems || mediaItems.length === 0) {
                    mediaLibraryDisplay.innerHTML = '<p class="text-gray-500 text-center col-span-full">No media files found</p>';
                    return;
                }
                mediaItems.forEach(item => {
                    const container = document.createElement('div');
                    container.className = 'gallery-item';
                    let mediaElement;
                    const fileExtension = item.filename.toLowerCase().split('.').pop();
                    if (["mp4", "webm", "ogg", "mov"].includes(fileExtension)) {
                        mediaElement = document.createElement('video');
                        mediaElement.src = item.path;
                        mediaElement.autoplay = true;
                        mediaElement.loop = true;
                        mediaElement.muted = true;
                        mediaElement.playsInline = true;
                        mediaElement.style.width = '100%';
                        mediaElement.style.display = 'block';
                        // Add video indicator
                        const videoIndicator = document.createElement('div');
                        videoIndicator.className = 'absolute top-2 right-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs';
                        videoIndicator.innerHTML = '<i class="fas fa-play mr-1"></i>VIDEO';
                        // Place indicator inside mediaContainer, not container
                        const mediaContainer = document.createElement('div');
                        mediaContainer.className = 'relative';
                        mediaContainer.appendChild(mediaElement);
                        mediaContainer.appendChild(videoIndicator);
                        // Add source indicator
                        const sourceIndicator = document.createElement('div');
                        sourceIndicator.className = 'absolute top-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs';
                        sourceIndicator.textContent = item.source;
                        mediaContainer.appendChild(sourceIndicator);
                        container.appendChild(mediaContainer);
                    } else {
                        mediaElement = document.createElement('img');
                        mediaElement.src = item.path;
                        mediaElement.alt = item.filename;
                        mediaElement.style.width = '100%';
                        mediaElement.style.display = 'block';
                        mediaElement.style.height = 'auto';
                        mediaElement.style.objectFit = 'unset';
                        mediaElement.onerror = () => {
                            mediaElement.style.display = 'none';
                        };
                        // Add source indicator
                        const sourceIndicator = document.createElement('div');
                        sourceIndicator.className = 'absolute top-2 left-2 bg-black bg-opacity-50 text-white px-2 py-1 rounded text-xs';
                        sourceIndicator.textContent = item.source;
                        const mediaContainer = document.createElement('div');
                        mediaContainer.className = 'relative';
                        mediaContainer.appendChild(mediaElement);
                        mediaContainer.appendChild(sourceIndicator);
                        container.appendChild(mediaContainer);
                    }
                    // Add filename
                    const filenameDiv = document.createElement('div');
                    filenameDiv.className = 'p-3 bg-gray-50';
                    filenameDiv.innerHTML = `
                        <div class="text-sm font-medium text-gray-900 truncate">${item.filename}</div>
                        <div class="text-xs text-gray-500">${item.type} ‚Ä¢ ${item.source}</div>
                    `;
                    container.appendChild(filenameDiv);
                    container.addEventListener('click', () => openImageModal(item.path, item));
                    mediaLibraryDisplay.appendChild(container);
                });
            }

            // Filter functionality
            const filterAllBtn = document.getElementById('filterAll');
            if (filterAllBtn) {
                filterAllBtn.addEventListener('click', () => {
                    setActiveFilter('all');
                    displayMediaLibrary(allMediaData);
                });
            }

            const filterWebdesignsBtn = document.getElementById('filterWebdesigns');
            if (filterWebdesignsBtn) {
                filterWebdesignsBtn.addEventListener('click', () => {
                    setActiveFilter('webdesigns');
                    const filtered = allMediaData.filter(item => item.source === 'webdesigns');
                    displayMediaLibrary(filtered);
                });
            }

            const filterTobejsonBtn = document.getElementById('filterTobejson');
            if (filterTobejsonBtn) {
                filterTobejsonBtn.addEventListener('click', () => {
                    setActiveFilter('tobejson');
                    const filtered = allMediaData.filter(item => item.source === 'tobejson');
                    displayMediaLibrary(filtered);
                });
            }

            const filterVideosBtn = document.getElementById('filterVideos');
            if (filterVideosBtn) {
                filterVideosBtn.addEventListener('click', () => {
                    setActiveFilter('videos');
                    const filtered = allMediaData.filter(item => item.type === 'video');
                    displayMediaLibrary(filtered);
                });
            }

            const filterImagesBtn = document.getElementById('filterImages');
            if (filterImagesBtn) {
                filterImagesBtn.addEventListener('click', () => {
                    setActiveFilter('images');
                    const filtered = allMediaData.filter(item => item.type === 'image');
                    displayMediaLibrary(filtered);
                });
            }

            function setActiveFilter(filter) {
                currentFilter = filter;
                
                // Remove active class from all filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active', 'bg-blue-500', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                });
                
                // Add active class to clicked button
                const activeButton = document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`);
                if (activeButton) {
                    activeButton.classList.remove('bg-gray-200', 'text-gray-700');
                    activeButton.classList.add('active', 'bg-blue-500', 'text-white');
                }
            }

            // Function to show flash messages
            function showFlashMessage(message, type = 'info') {
                // Remove any existing flash messages
                const existingFlash = document.querySelector('.flash-card');
                if (existingFlash) {
                    existingFlash.remove();
                }

                const flashCard = document.createElement('div');
                flashCard.className = 'flash-card';
                
                // Set background color based on type
                if (type === 'success') {
                    flashCard.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                } else if (type === 'error') {
                    flashCard.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                } else {
                    flashCard.style.background = 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)';
                }
                
                flashCard.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            ${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium">${message}</p>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(flashCard);
                
                // Show the flash card
                setTimeout(() => {
                    flashCard.classList.add('show');
                }, 100);
                
                // Hide the flash card after 3 seconds
                setTimeout(() => {
                    flashCard.classList.remove('show');
                    setTimeout(() => {
                        if (flashCard.parentNode) {
                            flashCard.remove();
                        }
                    }, 500);
                }, 3000);
            }

            // Function to show welcome div
            function showWelcomeDiv() {
                console.log('showWelcomeDiv function called');
                const welcomeDiv = document.getElementById('welcomeDiv');
                console.log('Welcome div element found:', !!welcomeDiv);
                
                if (welcomeDiv) {
                    // Make sure it's visible
                    welcomeDiv.style.display = 'flex';
                    welcomeDiv.classList.remove('hidden');
                    
                    const modal = welcomeDiv.querySelector('div');
                    console.log('Modal element found:', !!modal);
                    
                    if (modal) {
                        modal.classList.remove('scale-95');
                        modal.classList.add('scale-100');
                    }
                    console.log('Welcome div shown immediately');
                } else {
                    console.error('Welcome div element not found');
                }
            }

            // Function to close welcome div
            function closeWelcomeDiv() {
                console.log('closeWelcomeDiv function called');
                const welcomeDiv = document.getElementById('welcomeDiv');
                if (welcomeDiv) {
                    // Hide immediately
                    welcomeDiv.style.display = 'none';
                    welcomeDiv.classList.add('hidden');
                    welcomeDiv.style.visibility = 'hidden';
                    welcomeDiv.style.opacity = '0';
                    console.log('Welcome div closed and hidden immediately');
                } else {
                    console.error('Welcome div not found for closing');
                }
            }

            // Set up event listeners after a short delay to ensure DOM is ready
            setTimeout(() => {
                // Set up close welcome button
                const closeWelcomeBtn = document.getElementById('closeWelcomeBtn');
                console.log('Close welcome button found:', !!closeWelcomeBtn);
                if (closeWelcomeBtn) {
                    closeWelcomeBtn.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Close welcome button clicked');
                        closeWelcomeDiv();
                        return false;
                    };
                    console.log('Close welcome button event listener added');
                } else {
                    console.error('Close welcome button not found');
                }

                // Set up close welcome X button
                const closeWelcomeX = document.getElementById('closeWelcomeX');
                console.log('Close welcome X button found:', !!closeWelcomeX);
                if (closeWelcomeX) {
                    closeWelcomeX.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Close welcome X button clicked');
                        closeWelcomeDiv();
                        return false;
                    };
                    // Also add mousedown event as backup
                    closeWelcomeX.onmousedown = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Close welcome X button mousedown');
                        closeWelcomeDiv();
                        return false;
                    };
                    console.log('Close welcome X button event listeners added');
                } else {
                    console.error('Close welcome X button not found');
                }

                // Also close when clicking outside the modal
                const welcomeDiv = document.getElementById('welcomeDiv');
                console.log('Welcome div found for outside click:', !!welcomeDiv);
                if (welcomeDiv) {
                    welcomeDiv.onclick = function(e) {
                        if (e.target === welcomeDiv) {
                            console.log('Clicked outside modal, closing welcome div');
                            closeWelcomeDiv();
                        }
                    };
                    console.log('Outside click event listener added');
                }
            }, 1000);

            // Close on Escape key press
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const welcomeDiv = document.getElementById('welcomeDiv');
                    if (welcomeDiv && !welcomeDiv.classList.contains('hidden')) {
                        console.log('Escape key pressed, closing welcome div');
                        closeWelcomeDiv();
                    }
                }
            });

            async function performLogout() {
                try {
                    // Call server-side logout endpoint
                    const token = localStorage.getItem('token');
                    if (token) {
                        await fetch('https://instapinz-backend.onrender.com/api/auth/logout', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${token}`
                            }
                        });
                    }
                    
                    // Clear the token from localStorage
                    localStorage.removeItem('token');
                    localStorage.removeItem('username');
                    
                    // Show logout message
                    showFlashMessage('Logged out successfully! üëã', 'success');
                    
                    // Redirect to login page after a short delay
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 1500);
                } catch (error) {
                    console.error('Logout error:', error);
                    // Even if server call fails, still logout locally
                    localStorage.removeItem('token');
                    localStorage.removeItem('username');
                    showFlashMessage('Logged out successfully! üëã', 'success');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 1500);
                }
            }
        });
    </script>
    <script src="js/imageDisplay.js"></script>
</body>
</html> 